<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link type="text/css" rel="stylesheet" href="css/import.css"/>
    <title>GroovyServ @ GitHub</title>
  </head>
  <body>
    <div id="container">
      <div id="header">
        <img id="logo" src="images/logo.png" alt="GroovyServ" />
        <div id="project">
          by <a href="http://github.com/kobo">kobo</a> project
        </div>
      </div>

      <div id="nav">
        <ul>
          <li><a class="home" href="index.html">Home</a></li>
          <li><a class="document" href="document.html">Documentation</a></li>
          <li><a class="download" href="download.html">Download</a></li>
          <li><a class="source" href="http://github.com/kobo/groovyserv">Source</a></li>
        </ul>
      </div>

      <div id="content">
        <div class="section">
          <h2>README</h2>
          <pre>
============
Introduction
============

GroovyServ makes startup time quicker, by pre-invoking groovy as a TCP/IP
server. If you know gnuserv(gnudoit)/emacsserver/emacsclient, this is like that.

In the case of scripting in dynamic-type languages, quick response about
invocation is very important. Try-and-run cycles is repeated frequently
than static-type languages, so sometimes 2 seconds or even a second might
be intolerable.

GroovyServ reduces the startup time of JVM and Groovy runtime
significantly. In most situations it is 10 to 20 times faster than
regular Groovy. The following times are averages of 3 times which
measured invocation in Groovy 1.7 on Windows XP (Core(TM) 2 Duo 2GHz).

  Groovy(non native)  2.32 (sec)
  Groovy(native exe)  0.90 (sec)
  GroovyServ          0.10 (sec)

<span id="requirements">============</span>
Requirements
============

GroovyServ is developed for following environment/OS. Please report if it
runs on the others.

  - Windows XP + Cygwin 1.7.x
  - Windows XP without Cygwin
  - Mac OS X 10.5/6 (Intel Mac)
  - Ubuntu Linux 9.10

Version of JDK is following:

  - JDK 6u20 or later (Mac OS X)
  - JDK 6u21 or later (Windows, Linux)

Version of Groovy is following:

  - Groovy 1.7 or later

========
Language
========

The Server is written in Java with JNA(Java Native Access).  There are
two types of clients, one is written in C and another is written in Ruby.

========
Security
========

GroovyServ has a possibility to run any groovy script from client.
So server-client connection is limited to the connection from the same
machine (localhost). And the connection is authenticated by simple
cookie mechanism. The cookie file is stored at ~/.groovy/groovyserv/cookie
and the file mode set to 0400. But in Windows environment, it is not
effective. So appropriately protect access to the file in Windows if
needed.

===========================
Install from binary package
===========================

Download and expand GroovyServ distribution package

  groovyserv-0.5-win32-bin.zip

or

  groovyserv-0.5-MacOSX-x86_64-bin.zip

to any directory. For example:

  &gt; mkdir ~/opt
  &gt; cd ~/opt
  &gt; unzip groovyserv-0.5-win32-bin.zip

and add bin directory to PATH environment variable.
For example in bash/bourne shell:

  export PATH=~/opt/groovyserv-0.5/bin:$PATH

That's all for preparing. When you invoke groovyclient, groovyserver
automatically starts in background. At first, you might have to wait
for a few seconds to startup.

  &gt; groovyclient -v
  starting server..
  Groovy Version: 1.7.3 JVM: 1.6.0_20

<span id="build">======================</span>
Build from source code
======================

Download and expand GroovyServ source package groovyserv-0.5-src.zip
to any directory. For example:

  &gt; mkdir -p ~/opt/src
  &gt; cd ~/opt/src
  &gt; unzip groovyserv-0.5-src.zip

Build with Maven2 as follows:

  &gt; cd ~/opt/src/groovyserv-0.5/
  &gt; mvn clean verify

Then some zip files will be generated. According to "Install from
binary package", install the bin package.

  ~/opt/src/groovyserv-0.5/target/groovyserv-0.5-&lt;OS&gt;-&lt;arch&gt;-bin.zip

If some tests fail, you can try as follows:

  with UTF-8 encoding:

    &gt; export _JAVA_OPTIONS=-Dfile.encoding=UTF-8
    &gt; mvn clean verify

  skip integration tests:

    &gt; mvn clean package

  skip all tests:

    &gt; mvn -Dmaven.test.skip=true clean package

To build it in Windows, you need Cygwin and gcc.
You must install them before trying to build.

<span id="environmentVariables">=====================</span>
Environment variables
=====================

GroovyServ uses the following environment variables in runtime.

  HOME (only in Linux or Mac OS X)

    It's used to decide ~/.groovy/groovyserv directory path which is
    used for logging, storing cookie and PID. It's set by default in
    unix-like OS.

  USERPROFILE (only in Windows)

    It's used to decide ~\.groovy\groovyserv directory path which is
    used for logging, storing cookie and PID. It's set by default in
    Windows. If server process is invoked by groovyserver.bat, PID
    file doesn't exist.

  JAVA_HOME

    It's used by Groovy.
    Generally, it has been already set through installing Groovy.

  GROOVY_HOME

    It's used to specify groovy command path.
    Generally, it has been already set through installing Groovy.

  GROOVYSERVER_PORT (optional)

    It's used to specify the port number for server or client.

==========
How to use
==========

You can use 'groovyclient' command as a replacement of 'groovy'
command.  If the server is not running, it starts automatically. You
can also invoke the serverexplicitly.

  &gt; groovyserver

About groovyserver command options refer to "groovyserver options"
section.

=======================
Restriction/Differences
=======================

* You can't concurrently use different current directory on a server.
  If you execute the following,

  &gt; groovyclient ... | (cd /tmp; groovyclient ... )

  the following exception will be occurred:

    org.jggug.kobo.groovyserv.GroovyServException: Can't change current
    directory because of another session running on different dir: ...

  It also meets conditions if you invoke groovyclient simultaneously
  from two or more consoles. But if the running periods of each
  groovyclient are not overlapping, it can run without exception.

  If needed, you can run multiple groovy servers for separated ports.

* A static variable is shared among groovy program executions.
  For instance, the system properties are shared.

 &gt; groovy -e "System.setProperty('a','abc')"
 &gt; groovy -e "println System.getProperty('a')"
 abc

* Normally environment variables of when groovyserv was invoked are used
  instead of those of groovyclient side. But if you specify -Cenv/-Cenv-all
  option, you can reflect the values of environment variables of client
  to the server. Whichever with or without those options, only the
  CLASSPATH variable is always reflected to the server.

* Values of Groovy's -cp option and CLASSPATH variable are passed to the
  server and added/overwrote to environment variables of the server
  process. But it is only to add, never to remove.

=====================
groovyclient's option
=====================

  -Ch,-Chelp                       Usage information of groovyclient options
  -Cp,-Cport <port>                Port number to connect to groovyserver
  -Ck,-Ckill-server                Kill groovyserver
  -Cr,-Crestart-server             Restart groovyserver
  -Cq,-Cquiet                      Suppress statring messages
  -Cenv <substr>                   Pass the environment variables which name
                                   includes specified substr
  -Cenv-all                        Pass all environment variables
  -Cenv-exclude <pattern>          Don't pass the environment variables which
                                   name matches with specified pattern

=====================
groovyserver's option
=====================

Options are as follows:

  -v        verbose output. print debugging information etc.
  -k        kill the running groovyserver (groovyserver.bat cannot use this)
  -r        restart groovyserver (groovyserver.bat cannot use this)
  -p &lt;port&gt; specify the port that connected from groovyclient

=============================
Stop and restart groovyserver
=============================

There are two ways for invoke groovyserver. First one is, called
explicit server invocation, using bash shell script 'groovyserver' or
use batch file 'groovyserver.bat'.  Second one is, called transparent
server invocation, the groovyclient which detects groovyserver not
running, invokes groovyserver backgrond automatically.

The commands for explicit server invocation are:

 - Bash shell script 'groovyserver' (for MacOS X, Linux, Cygwin)
 - batch file 'grovyserver.bat'     (For Windows without Cygwin)

Following shows the availability of those commands:


                          | Windows      | Windows      | MacOS X,
                          | Cygwin       | nocygwin     | Linux
--------------------------+--------------+--------------+-----------
groovyserver              | OK           |   N/A        | N/A
--------------------------+--------------+--------------+-----------
groovyserver.bat          | OK           |   OK         | N/A
--------------------------+--------------+--------------+-----------

                           N/A ... Not Available
                           OK ...  Available

Batch file version groovyserver.bat don't support -r and -k options
because of technical reasons. So you can't neither stop nor restart
groovyserver from command line. Instead, when invoke groovyserver
through groovyserver.bat it appeals as a minimized window, so you can
stop it by closing the window. After that you can restart groovyserver
transparently through groovyclient.

It's to be noted that even under Cygwin environment, groovyclient uses
'groovyserver.bat' internally rather than 'groovyserver' shell script
at transparent invocation.

Under Cygwin, therefore, the situation is as follows:

 - When invoke groovyserver explicitly with groovyserver shell
   script, you can use the same groovyserver shell script with -r or
   -k option to restart or stop the groovyserver.

 - When invoke groovyserver explicitly with groovyserver.bat batch
   file, you can stop the groovyserver by closing the window which
   opened by the groovyserver.bat.

 - If invoke groovyserver transparently through groovyclient.exe, you
   can stop the groovyserver by closing the window which opened by the
   groovyserver.bat.

It might be confusing so we would like to implement -r and -k options
for groovyserver.bat in future.

Incidentally, in the case of transparent invocation you can't supply
options(e.g. -v) for groovyserver/.bat which to be invoked
internally. If it is needed, please invoke groovyserver explicitly.

================================
Environment Variable Propagation
================================

From GroovyServ 0.5, you can pass any environment variables to the
groovyserver.

With '-Cenv' option of groovyclient, you can pass the environment
variables which name includes the specified substring to
groovyserver. The values of those variables on the client process are
sent to the server process, and the values of same name environment
variable on the server are set to or overwritten by the passed
values. This feature is especially useful for IDEs' which uses
environment variables to pass configuration information with invoking
external command which is written Groovy. Textmate is one of those
IDEs reportedly.

When you specify option '-Cenv-all', all environment variables of the
client process are sent to the groovyserver. And option
'-Cenv-exclude' excludes variables which name includes specified
substring.

When you specify option "-Cenv PART_OF_ENVIRONMENT_VAR_NAME",
the set of environment variables sent to the server are determined
by following pseudo code:

  allEnvironmentVariables.entrySet().collect{
     it.name.contains("PART_OF_ENVIRONMENT_VAR_NAME"
  }

Consider combination of -Cenv-all, -Cenv-excludes, like:

 -Cenv SUBSTRING
 -Cenv-all
 -Cenv-exclude EXCLUDE_SUBSTRING

The result of following pseudo code are sent to the groovyserver:

 allEnvironmentVariables.entrySet().collect {
    if (( <-Cenv-all are specified?>
          || it.name.contains(SUBSTRING))
        && !(it.name.contains(EXCLUDE_SUBSTRING))) {
      return true
    }
    else {
      return false
   }
 }

Note that those environment variables remain after client is
finished. And of course environment variable are not 'MT Safe' on the
the server, when multiple groovyclient instance invoked
simultaneously, the value are overwritten by subsequent invocation.

===========
Port number
===========

In groovyserver, to change the port number, you can use
GROOVYSERVER_PORT environment variable or -p option. The -p option is
treated more prior than GROOVYSERVER_PORT environment variable.

  &gt; export GROOVYSERVER_PORT=1963
  &gt; groovyserver

or

  &gt; groovyserver -p 1963

In groovyclient, in Addition to the way using environment variable
GROOVYSERVER_PORT, you can spcify portnumber by -Cp option.

  &gt; groovyclient -Cp

In transparent groovyserver invocation, port number is supplied to the
server with -p option.

========
Log file
========

The output from groovyserver are logged to:

  ~/.groovy/groovyserv/groovyserver.log

====
Tips
====

Following aliases might be useful.

  alias groovy=groovyclient

For windows environment:

  doskey groovy=groovyclient $*
          </pre>
        </div>
      </div>

      <div id="footer">
        Get the source code on GitHub : <a href="http://github.com/kobo/groovyserv">kobo/groovyserv</a>
      </div>
    </div>

    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
      try {
        var pageTracker = _gat._getTracker("UA-3438563-4");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
