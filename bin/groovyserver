#!/bin/sh

export CLASSPATH=src/main/groovy
if  [ "$OPT"=="" ]; then
  export OPT="-Dgroovyserver.verbose=true"
fi

if [ "$1" == "-k" ]; then
  if [ -f ~/.groovy/groovyserver/pid ]; then
    kill  `cat ~/.groovy/groovyserver/pid`
    rm  ~/.groovy/groovyserver/pid
  fi
  exit
fi

if [ -f ~/.groovy/groovyserver/pid ]; then
  echo Already running groovy server, pid is `cat ~/.groovy/groovyserver/pid`.
  echo To kill the server, run "groovyserver -k".
  echo If groovy server does not ruuning actually, retry after
  echo removing file: ~/.groovy/groovyserver/pid
  exit
fi

GROOVYSERV_HOME=`dirname $0`/..

CP=$GROOVYSERV_HOME/src/main/groovy:$GROOVYSERV_HOME/target/classes:~/.m2/repository/net/java/dev/jna/jna/3.2.2/jna-3.2.2.jar

if $cygwin ; then
  CP=`cygpath --path --mixed "$CP"`
fi

$GROOVY_HOME/bin/groovy -cp $CP $OPT $GROOVYSERV_HOME/src/main/groovy/org/jggug/kobo/groovyserv/GroovyServer.groovy "$@" &

pid=$!

sleep 3
if ps -p $pid | grep $pid > /dev/null; then
  echo $pid > ~/.groovy/groovyserver/pid
fi

